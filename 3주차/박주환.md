질문1. 웹소켓에서의 서버는 어떻게 항구적인 연결을 관리하는가?   
질문2. 카카오톡은 서버가 1개라서 마비사태가 일어났던 것인지?  

# 9장. 웹 크롤러 설계
## 웹 크롤러의 사용방안
- 검색 엔진 인덱싱
- 웹 아카이빙
- 웹 마이닝
- 웹 모니터링

## 주의 사항들
1. 규모의 확장성  
: 웹은 거대하기에, 병행성을 이용할 수 있어야한다.
2. 안정성  
: 웹에는 악성코드, 함정 등이 많기에 비정상적인 입력 또는 무한 루프 등에 빠지지 않아야한다.  
3. 예절  
: 한 서버에 한 번에 너무 많은 요청을 하면 안된다.
4. 확장성  
: 글을 크롤링 하는 봇이, 이미지도 수집하고 싶다면, 쉽게 가능해야 한다.  

## 고려 사항들
- 시작 URL 집합  
: 웹 크롤러가 크롤링을 시작하는 지점.  
  이부분을 잘 설정해야함.  
- 미수집 URL저장소  
: 탐색하지 않은 URL을 저장하는 장소, 보통은 큐로 구현
- 콘텐츠 저장소  
: 문서 저장, 대부분 디스크에 저장하지만 Hot 한 컨텐츠는 메모리에 저장함

## BFS VS DFS
- DFS의 경우, 트리가 얼마나 큰지도 모르고, 같은 서버에 계속해서 접근할 수 있기 때문에 BFS가 나은 선택이다.
- 이때 우선순위를 결정해주는 알고리즘을 더해주는게 좋다.


# 10장. 알림 시스템 설계
- 알림 시스템은 고객에게 중요할만한 정보를 비동기적으로 제공한다.
- 같은 고객에 대해서 너무 많은 알림을 발송하는 경우 피로감을 줄 수 있기 때문에 알림 수신을 거부할 수 있기 때문에 유저마다 적절한 알림 횟수로 제한해야 한다.
- 서비스의 규모와 특성에 따라 대량의 트래픽을 발생시킬 수 있기 때문에 주의해야 한다.
- 크게 푸시 알림, SMS 메시지, e-mail 알림으로 분류할 수 있다.

## ios 푸시 알림
- iOS 에서 푸시 알림을 보내기 위해서는 세 가지 컴포넌트가 필요하다.
- 알림 제공자: 알림 요청을 만들어 애플 푸시 알림 서비스(APNS: Apple Push Notification Service)로 보내는 주체다.
- APNS: 애플이 제공하는 원격 서비스이며, 푸시 알림을 iOS 장치로 보내는 역할을 한다.
- iOS 단말: 푸시 알림을 수신하는 사용자 단말이다.

## android 푸시 알림
- 안드로이드 알림은 iOS 푸시와 비슷한 절차로 전송하며, APNS 대신 FCM(Firebase Cloud Messaging)을 사용하는 점만 다르다.

## SMS message, email
- 회사마다 각 서비스를 만들 수 있는 역량은 있지만, 보통은 서비스를 이용한다.

## 알림 시스템의 초기안
- 알림 시스템을 설계해서 APNS, FCM, SMS 서비스, eamil 서비스에 직접 접근  
장점: 구현이 간단함  
단점: 확장성이 부족

## 개선된 버젼
- 각 업무마다 큐를 구현해서 작업의 오류를 막고, 분산 처리할 수 있게 만든다.

## 안정성
- 데이터의 손실 방지를 위해 작업 서버에 `알림 로그 데이터베이스`를 구현한다.

# 11장. 뉴스 피드 시스템 설계
페이스북, 인스타그램과 같은 서비스

## 설계 범위
- 주요 기능
- 피드에 올라오는 스토리의 순서 → 시간 순, 토픽 포인트 순 등
- 최대 팔로우 할 수 있는 친구의 수
- 트래픽 규모
- 피드에 이미지, 비디오 첨부 기능

## 발행 API
- HTTP의 POST방식을 사용
- ex) POST/v1/me/feed

## 피드 읽기 API
- HTTP의 GET방식을 사용
- ex) GET/v1/me/feed

## 웹서버
- 스팸을 막고, 사용자의 적절한 사용을 도와주는 등의 역할을 수행해야함

## 팬아웃 서비스
- 사용자가 새 포스팅을 하면 즉시, 팔로워들에게 그 포스팅을 모두 전달하는 방식
- 장점: real-time으로 전송되어 사용자가 즉시 볼 수 있다.  
        뉴스피드를 읽어들이기까지 시간이 짧게 소용된다.
- 단점: 컴퓨팅 자원의 낭비  
        핫키 문제가 발생할 수 있다.

## 읽기 시점에 팬아웃하는 모델
- 피드 갱신 요청을 받으면, 갱신하는 모델.
- 장점: 로그인하지 않는 사용자가 많은 경우에 이득  
        핫키 문제 발생 X
- 단점: 읽어들이기 까지 시간소요 많음

## 캐시 구조
캐시를 사용해서 인기 콘텐츠, 좋아요, 답글 등을 보관해서 효율성을 증대

# 12장. 채팅 시스템 설계

## 문제 이해 및 설계 범위
- 응답지연이 낮은 일대일 채팅 기능
- 최대 100명 까지 참여할 수 있는 그룹 채팅 기능
- 사용자의 접속상태 표시 기능
- 다양한 단말 지원, 하나의 계정으로 여러 단말에 동시 접속 지원
- 푸시 알림
- 처리해야 하는 트래픽 규모 : 일별 능동 사용자 수(DAU) 기준으로 5천만 명  

대중적인 프로그램들은 대부분 HTTP를 사용해서 구현했다. 하지만 HTTP는 클라이언트가 연결을 만드는 구조이기 때문에 서버가 연결을 만드는 방식을 구현하기 위해 폴링, 롱 폴링, 웹소켓 등이 등장하였다.

## 폴링
클라이언트가 주기적으로 서버에게 새 메시지의 존재를 확인하는 방법.  
자주 할 수록 자원이 낭비됨.

## 롱 폴링
클라이언트가 새 메시지가 반환되거나 타임아웃 될 때까지 연결을 유지하는 방법.  
서버는 클라이언트가 연결을 하고 있는지 알 수 있는 방법이 없다. 즉, 아직 비효율적임

## 웹소켓
서버가 클라이언트에게 비동기 메시지를 보낼 때 사용하는 기술.  
- 웹소켓의 연결은 클라이언트가 먼저함. 이 연결은 항구적이며 양방향임.  
- 따라서 이 연결을 통해 각 메시지 수신 클라이언트들은 채팅 서비스 서버와 연결 및 통신가능
- 연결이 항구적이기에, 서버의 연결관리가 필수적임


