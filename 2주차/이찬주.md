# 질문

1. memcached vs redis 중 어떤 것을 사용하는 것이 좋을까?

2. short url에 대해서 서버에서 만들어서 던져주는 거 같은데 프론트에서 해당 url를 기반으로 어떻게 뷰를 보여주는건지



# 5장 안정 해시설계

## 해시 키 재배치 문제
해시 함수를 통해서 부하를 나누게 되면, 한 서버가 내려갔을 때 모듈러 연산을 N이 달라지면서 키값 매핑이 달라짐 -> 해시 키 재배치 문제라고 함

## 노드 복제
이에 안정해시가 나옴 k개의 키를 n개의 서버에 저장하는 방법 이를 구현하는 방법은 해시 값 범위를 원형으로 만들어서 중간 중간 서버를 배치함 특정 키값에 대해서 저장할 일이 생기면, 시간 방향으로 이동하면서 가장 가까운 서버에 입력

중간에 특정 서버가 빠지더라도 부분적으로만 키값을 갱신해주면 됨 근데 특정 서버사이의 범위에 키값이 많으면 특정 서버에 키값이 몰릴 수 있음

그래서 중간에 가상서버를 둬서 처리 즉 서버1 인척하는 가상 노드를 다수개, 서버2 인척하는 가상 노드 다수개를 해당 원형 해시 링에 넣어둬서 몰림현상 방지

# 6장 키-값 저장소 설계

CAP이론 설명 각각 모든 데이터를 모든 노드가 똑같이 가지고 있어야됨 특정노드가 죽더라도 응답은 받응 수 있어야됨 네트워크 파티션이 생기더라도 시스템은 계속해서 동작해야됨

세가지 중에서 2가지만 성립할수밖에 없음

데이터를 파티션해서 노드에 저장, 이때 N수를 정해서 똑같은 파티션 데이터를 몇개의 노드에 똑같이 저장할지 정함

데이터 일관성에 대해서는 하나의 중재자를 두고, 몇개의 서버에 쓰기를 진행할지에 따라 다름 이것에 대해서 몇개의 노드에 데이터를 복사할 것 이고(N) 몇개에 노드에 쓰기를 진행하도록 할 것이고(W) 몇개의 노드에서 해당 정보를 똑같이 읽을 수 있을 지(R)로 일관성 정도 관리

강한 일관성, 약한 일관성(최신 정보에 대해서 반영 못할수있음), 최종일관성(결국 데이터에 대해 전부 동기화)

다중화하면 일관성이 떨어질 수 있음 -> 버저닝 및 벡터 시계

컴플릭트 났을 때 버전이 낮으면 이전 버전이라고 생각하고버려버림

장애 감지에 모든 노드에 미리 연결을 해놓고 멀티캐스트하는 방식으로 만들 수도 있지만 책에서는 가십 알고리즘 설명함 

각자 박동수를 체크하다가 리스트를 각자 주변에 던짐, 만약 해당 박동수가 추가 안되면 장애라고 인지

일시적 장애면 다른 노드에서 갱신 정보를 가지고 있다가 보내줌 영구적 장애 처리는 사본등을 기반으로 최신 버전으로 동기화하는 반-엔트로피 프로토콜로 ㄱ

각 노드마다 완전한 분산을 목표러하면 모든 기능들을 실행할 수 있도록 만들어야됨


# 7장 분산시스템을 위한 유일 ID 생성기설계

ID에 대해서 64비트, 정렬 가능, 유일해야둼

다중 마스터 복제, UUID, 티켓 서버, 트위터 스노플레이크

## 다중 마스터 복제

데이터베이스 auto increment 기능 활용 ID값을 데이터베이스 갯수만큼 증가 데이터베이스가 늘어날때마다 수정해야됨

## UUID
UUID 128비트고 정렬을 못함 숫자아닌 값이 들어감

## 티켓 서버
티켓 서버 auto increment를 하나의 티켓서버에서 진행함
티켓서버가 spof, 티켓서버를 분산하면 동기화 문제 발생

## 트위터 스노플레이크

트위터 스노플레이크 64비트를 사인, 타임스탬프, 일련번포 등을 나눠서 사용
해당 타임스탬프에 저장 기간에 따라서 비트 수를 유동적으로 조절

# 8장 URL 단축기설계

프론트에서 특정 URL를 주면 ShortURL로 만들어서 줘야되는 상황
단기간에 꽤나 많이 생성해야됨

## 해시 후 충돌 해소

잘 알려진 해시함수를 기반으로 7글자의 문자열로 줄이면 되긴함
그러나 이런 해시함수 돌려서 7글자 이상으로 나옴
그러므로 1~7 이런씩으로 끊으면 충돌확률이 높아짐 
충돌이 나면, 사전에 만들어놨던 문자열을 해당 URL 해시 값에 덧붙임

단축 URL을 생성할 때 데이터베이스에 한번 이상 질의를 해야하므로 오버헤드가 큼 -> 데이터베이스 대신 블롭 필터를 사용

## Base-62 변환

62개의 글자로 수를 나타냄
이런식으로 변환하면 숫자의 크기에 따라서 ShortURL의 길이가 달라짐

## 차이점

고정된 값을 기반으로 저장하고 보안상으로 안전한데 충돌시에 고생할꺼나 VS 보안상으로 좀 위험하고 저장되는 값이 가변되지만 특정 방식만 적용해서 구현할거냐

# 상세 설계
URL이 디비에 있는지 없는 지에 따라서 새로만드냐 아니냐 ㄱㄱ
ID 값은 전장에서 설명했던 방식 중 하나로 선택 

사용자 단축 URL에 대해서 로드밸런서를 통해 요청이 들어오면 캐시를 봐서 있음 날리고 없으면 디비에서 찾음 디비에 없으면 URL이 잘못되었다고 생각